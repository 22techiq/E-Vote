<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Election</title>
<!-- Prevent iframe embedding -->
<meta http-equiv="X-Frame-Options" content="DENY">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#020617;
  --glass:rgba(15,23,42,.6);
  --border:rgba(148,163,184,.15);
  --accent:#38bdf8;
  --gold:#facc15;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins;
  background:
    radial-gradient(800px 400px at 10% -10%,#1e293b55,transparent),
    radial-gradient(700px 300px at 90% 10%,#38bdf833,transparent),
    var(--bg);
  color:var(--text);
}
.app{max-width:420px;margin:auto;padding:14px}
h1{text-align:center;font-size:17px;margin:8px 0}
.timer{text-align:center;font-size:11px;color:var(--gold);margin-bottom:10px}

.card{
  background:var(--glass);
  backdrop-filter:blur(14px);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  margin-bottom:12px;
}

.input{
  display:flex;gap:8px;align-items:center;
  background:#020617;border:1px solid var(--border);
  border-radius:10px;padding:8px;font-size:12px
}
.input input{
  border:none;background:none;outline:none;
  color:var(--text);width:100%
}

.section-title{
  font-size:11px;color:var(--muted);
  margin:12px 0 6px;
  display:flex;gap:6px;align-items:center
}

.candidate{
  display:flex;align-items:center;gap:10px;
  background:#020617;border:1px solid var(--border);
  border-radius:12px;padding:8px;margin-bottom:6px;
  cursor:pointer;transition:.2s
}
.candidate:hover{border-color:var(--accent)}
.candidate img{
  width:34px;height:34px;border-radius:50%;object-fit:cover
}
.candidate span{flex:1;font-size:12px}
.candidate i{color:var(--accent)}

.winner{
  border-color:var(--gold)!important;
  box-shadow:0 0 16px #facc1566;
  animation:pulse 1.4s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 6px #facc1555}
  50%{box-shadow:0 0 18px #facc15aa}
  100%{box-shadow:0 0 6px #facc1555}
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}
th,td{
  padding:6px;
  border-bottom:1px solid var(--border);
  text-align:left;
}
th{color:var(--muted)}
tr.winner-row td{
  color:var(--gold);
  font-weight:600;
}
a{
color:yellow;
text-decoration:none;}
canvas{max-height:160px}
.footer{text-align:center;font-size:10px;color:var(--muted)}
</style>
</head>

<body>
<div class="app">

<h1><i class="fas fa-vote-yea"></i> School Election</h1>
<div class="timer" id="timer">Live voting & results</div>

<!-- ================= VOTING ================= -->
<div class="card">
  <div class="input">
    <i class="fas fa-id-card"></i>
    <input id="sid" placeholder="Student ID">
  </div>

  <div class="section-title"><i class="fas fa-user-tie"></i> President</div>
  <div class="candidate" onclick="vote('President',1)">
    <img src="https://i.imgur.com/1XKQbQp.jpg"><span>Alice</span><i class="fas fa-check"></i>
  </div>
  <div class="candidate" onclick="vote('President',2)">
    <img src="https://i.imgur.com/J6l19cE.jpg"><span>Bob</span><i class="fas fa-check"></i>
  </div>

  <div class="section-title"><i class="fas fa-file-signature"></i> Secretary</div>
  <div class="candidate" onclick="vote('Secretary',3)">
    <img src="https://i.imgur.com/3GvwNBf.jpg"><span>Carol</span><i class="fas fa-check"></i>
  </div>
  <div class="candidate" onclick="vote('Secretary',4)">
    <img src="https://i.imgur.com/abcd123.jpg"><span>Eve</span><i class="fas fa-check"></i>
  </div>

  <div class="section-title"><i class="fas fa-coins"></i> Treasurer</div>
  <div class="candidate" onclick="vote('Treasurer',5)">
    <img src="https://i.imgur.com/8Km9tLL.jpg"><span>Dan</span><i class="fas fa-check"></i>
  </div>
  <div class="candidate" onclick="vote('Treasurer',6)">
    <img src="https://i.imgur.com/xyz456.jpg"><span>Frank</span><i class="fas fa-check"></i>
  </div>
</div>

<!-- ================= RESULTS ================= -->
<div class="card">
  <div class="section-title"><i class="fas fa-chart-bar"></i> President Results</div>
  <canvas id="presChart"></canvas>
  <table id="presTable"></table>
</div>

<div class="card">
  <div class="section-title"><i class="fas fa-chart-bar"></i> Secretary Results</div>
  <canvas id="secChart"></canvas>
  <table id="secTable"></table>
</div>

<div class="card">
  <div class="section-title"><i class="fas fa-chart-bar"></i> Treasurer Results</div>
  <canvas id="treChart"></canvas>
  <table id="treTable"></table>
</div>

<div class="footer">Developed by <a href="">McOwino</a> â€¢ One Vote Per Position. Alt. <a href="../E-VoteAdvanced.html">Opt B</a></div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbwUly0O1dBoVRcyUtpoe-CrRCfjwLzj0VONi6raoinWkOFjAZMCQcq0iV-uotKbtTUrUQ/exec";
let charts={};

/* Vote */
function vote(position,candidate_id){
  const sid=document.getElementById("sid").value.trim();
  if(!sid) return alert("Enter Student ID");

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({student_id:sid,position,candidate_id})
  })
  .then(r=>r.json())
  .then(d=>alert(d.message));
}

/* Results */
function loadResults(){
  fetch(API_URL).then(r=>r.json()).then(data=>{
    render("President",data.President,"presChart","presTable");
    render("Secretary",data.Secretary,"secChart","secTable");
    render("Treasurer",data.Treasurer,"treChart","treTable");
  });
}

function render(position,list,chartId,tableId){
  if(!list) return;

  const labels=list.map(x=>x.name);
  const votes=list.map(x=>x.votes);
  const max=Math.max(...votes);

  if(charts[chartId]) charts[chartId].destroy();
  charts[chartId]=new Chart(document.getElementById(chartId),{
    type:"bar",
    data:{labels,datasets:[{data:votes}]},
    options:{plugins:{legend:{display:false}}}
  });

  let html=`<tr><th>Candidate</th><th>Votes</th></tr>`;
  list.forEach(x=>{
    html+=`<tr class="${x.votes===max&&max>0?'winner-row':''}">
      <td>${x.name}</td><td>${x.votes}</td>
    </tr>`;
  });
  document.getElementById(tableId).innerHTML=html;
}

setInterval(loadResults,3000);
loadResults();
</script>


  <!--Appscript
 " ONE VOTE PER POSTION" SHEET


  function getSettings() {
  const s = SpreadsheetApp.getActive().getSheetByName("Settings");
  const rows = s.getRange("A2:B").getValues();
  const map = {};
  rows.forEach(r => map[r[0]] = new Date(r[1]));
  return map;
}

function doPost(e) {
  const data = JSON.parse(e.postData.contents || "{}");
  const { student_id, position, candidate_id } = data;

  if (!student_id || !position || !candidate_id)
    return reply("Invalid request");

  const { OPEN_TIME, CLOSE_TIME } = getSettings();
  const now = new Date();

  if (now < OPEN_TIME || now > CLOSE_TIME)
    return reply("Voting is closed");

  const ss = SpreadsheetApp.getActive();

  // Student whitelist
  const students = ss.getSheetByName("Students")
    .getRange("A2:A").getValues().flat();

  if (!students.includes(student_id))
    return reply("Student ID not registered");

  const votesSheet = ss.getSheetByName("Votes");
  const votes = votesSheet.getDataRange().getValues();

  // One vote per position
  for (let i = 1; i < votes.length; i++) {
    if (votes[i][1] === student_id && votes[i][2] === position)
      return reply(`You already voted for ${position}`);
  }

  votesSheet.appendRow([
    new Date(),
    student_id,
    position,
    candidate_id
  ]);

  return reply("Vote recorded successfully");
}

function doGet() {
  const ss = SpreadsheetApp.getActive();
  const cand = ss.getSheetByName("Candidates").getDataRange().getValues();
  const votes = ss.getSheetByName("Votes").getDataRange().getValues();

  const results = { President: [], Secretary: [], Treasurer: [] };

  for (let i = 1; i < cand.length; i++) {
    const [id, name, position] = cand[i];
    let count = 0;
    for (let j = 1; j < votes.length; j++) {
      if (votes[j][3] == id) count++;
    }
    results[position].push({ name, votes: count });
  }

  return ContentService
    .createTextOutput(JSON.stringify(results))
    .setMimeType(ContentService.MimeType.JSON);
}

function reply(msg) {
  return ContentService
    .createTextOutput(JSON.stringify({ message: msg }))
    .setMimeType(ContentService.MimeType.JSON);
}
https://script.google.com/macros/s/AKfycbwUly0O1dBoVRcyUtpoe-CrRCfjwLzj0VONi6raoinWkOFjAZMCQcq0iV-uotKbtTUrUQ/exec
  -->

  <script>
/* =================================
   1. Disable Right Click
================================= */
document.addEventListener("contextmenu", e => e.preventDefault());

/* =================================
   2. Disable Copy / Cut / Paste
================================= */
["copy", "cut", "paste", "dragstart"].forEach(evt => {
  document.addEventListener(evt, e => e.preventDefault());
});

/* =================================
   3. Block DevTools Shortcuts
================================= */
document.addEventListener("keydown", function (e) {
  if (
    e.key === "F12" ||
    (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) ||
    (e.ctrlKey && e.key === "U")
  ) {
    e.preventDefault();
    return false;
  }
});

/* =================================
   4. DevTools Size Detection
================================= */
setInterval(() => {
  const widthDiff  = window.outerWidth - window.innerWidth;
  const heightDiff = window.outerHeight - window.innerHeight;

  if (widthDiff > 160 || heightDiff > 160) {
    document.body.innerHTML =
      "<h2 style='color:red;margin-top:20%'>Access Denied</h2>";
  }
}, 1000);

/* =================================
   5. Console Open Detection
================================= */
(function () {
  const element = new Image();
  Object.defineProperty(element, "id", {
    get: function () {
      document.body.innerHTML =
        "<h2 style='color:red;margin-top:20%'>Inspection Blocked</h2>";
    }
  });
  console.log(element);
})();

/* =================================
   6. Anti-Debugger Trap
================================= */
setInterval(function () {
  debugger;
}, 2000);

/* =================================
   7. Hide Source via Visibility Change
================================= */
document.addEventListener("visibilitychange", function () {
  if (document.hidden) {
    document.body.style.display = "none";
  } else {
    document.body.style.display = "block";
  }
});

/* =================================
   8. Disable View Source via Mouse
================================= */
document.onmousedown = function (e) {
  if (e.button === 2) return false;
};
</script>


</body>
</html>
