<!-- ADVANCED-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Election</title>
<!-- Prevent iframe embedding -->
<meta http-equiv="X-Frame-Options" content="DENY">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ðŸ”´ STYLES UNCHANGED -->
<style>
/* YOUR ORIGINAL CSS â€” NOT TOUCHED */



:root{
  --bg:#020617;
  --glass:rgba(15,23,42,.6);
  --border:rgba(148,163,184,.15);
  --accent:#38bdf8;
  --gold:#facc15;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,system-ui;
  background:radial-gradient(900px 500px at 10% -10%,#1e293b55,transparent),
             radial-gradient(700px 400px at 90% 10%,#38bdf833,transparent),
             var(--bg);
  color:var(--text);
}
.app{max-width:420px;margin:auto;padding:14px}
h1{text-align:center;font-size:17px;margin:6px 0}
.timer{text-align:center;font-size:12px;color:var(--gold);margin-bottom:10px}
.card{
  background:var(--glass);
  backdrop-filter:blur(16px);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  margin-bottom:12px;
}
.input{
  display:flex;gap:8px;align-items:center;
  background:#020617;border:1px solid var(--border);
  border-radius:10px;padding:8px;font-size:12px
}
.input input{
  border:none;background:none;outline:none;
  color:var(--text);width:100%
}
.section-title{
  font-size:11px;color:var(--muted);
  margin:12px 0 6px;
  display:flex;gap:6px;align-items:center
}
.candidate{
  display:flex;align-items:center;gap:10px;
  background:#020617;border:1px solid var(--border);
  border-radius:12px;padding:8px;margin-bottom:6px;
  cursor:pointer;transition:.2s
}
.candidate:hover{border-color:var(--accent)}
.candidate img{
  width:36px;height:36px;border-radius:50%;object-fit:cover
}
.candidate span{flex:1;font-size:12px}
.candidate i{color:var(--accent)}
.winner{
  border-color:var(--gold)!important;
  box-shadow:0 0 18px #facc1566;
  animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 8px #facc1555}
  50%{box-shadow:0 0 18px #facc15aa}
  100%{box-shadow:0 0 8px #facc1555}
}
canvas{max-height:180px}
.footer{text-align:center;font-size:10px;color:var(--muted)}


a{
  color:Yellow;
  text-decoration:none;
}



.results-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
.results-table th,
.results-table td{
  text-align: left;
  padding:8px;
  border-bottom:1px solid var(--border);
}
.results-table th{color:var(--muted)}
.results-table tr.leader{
  color:var(--gold);
  font-weight:600;
}





/* Vote Confirmation Modal */
.confirm-overlay{
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.75);
  backdrop-filter:blur(6px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.confirm-box{
  width:90%;
  max-width:320px;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  text-align:center;
  animation:pop .25s ease;
}

.confirm-box h3{
  margin:0 0 8px;
  font-size:15px;
}

.confirm-box p{
  font-size:12px;
  color:var(--muted);
  margin:6px 0;
}

.confirm-box .choice{
  margin:10px 0;
  font-size:13px;
  color:var(--gold);
}

.confirm-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.confirm-actions button{
  flex:1;
  border:none;
  border-radius:10px;
  padding:10px;
  font-size:12px;
  cursor:pointer;
}

.btn-cancel{
  background:#020617;
  color:var(--muted);
  border:1px solid var(--border);
}

.btn-confirm{
  background:linear-gradient(135deg,#38bdf8,#0ea5e9);
  color:#020617;
  font-weight:600;
}

@keyframes pop{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>

<body>
  <!--confirm popup-->
  <div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <h3><i class="fas fa-shield-check"></i> Confirm Vote</h3>
    <p>Please confirm your selection</p>

    <div class="choice" id="confirmText"></div>

    <div class="confirm-actions">
      <button class="btn-cancel" onclick="cancelVote()">Cancel</button>
      <button class="btn-confirm" onclick="submitVote()">Confirm</button>
    </div>
  </div>
</div>
  
  
  
<div class="app">

<h1><i class="fas fa-vote-yea"></i> School Election</h1>
<div class="timer" id="timer">Voting ends in: --:--:--</div>

<div class="card">
  <div class="input">
    <i class="fas fa-id-card"></i>
    <input id="sid" placeholder="Student ID">
  </div>

  <div class="section-title"><i class="fas fa-user-tie"></i> President</div>
  <div class="candidate" onclick="vote('President','Alice')">
    <img src="https://i.imgur.com/1XKQbQp.jpg"><span>Alice</span><i class="fas fa-check"></i>
  </div>
  <div class="candidate" onclick="vote('President','Bob')">
    <img src="https://i.imgur.com/J6l19cE.jpg"><span>Bob</span><i class="fas fa-check"></i>
  </div>
  
  
  
  
    <div class="candidate" onclick="vote('President','McOwino')">
    <img src="https://i.imgur.com/J6l19cE.jpg"><span>McOwino</span><i class="fas fa-check"></i>
  </div>
  
  
  <div class="candidate" onclick="vote('President','Alex')">
    <img src="https://i.imgur.com/J6l19cE.jpg"><span>Alex</span><i class="fas fa-check"></i>
  </div>
  
  
<!--Hidden on Frontend
  <div class="section-title"><i class="fas fa-file-signature"></i> Secretary</div>
  <div class="candidate" onclick="vote('Secretary','Carol')">
    <img src="https://i.imgur.com/3GvwNBf.jpg"><span>Carol</span><i class="fas fa-check"></i>
  </div>

  <div class="section-title"><i class="fas fa-coins"></i> Treasurer</div>
  <div class="candidate" onclick="vote('Treasurer','Dan')">
    <img src="https://i.imgur.com/8Km9tLL.jpg"><span>Dan</span><i class="fas fa-check"></i>
  </div>
</div>
-->
<div class="card">
  <div class="section-title"><i class="fas fa-chart-bar"></i> Live Results</div>
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <div class="section-title">
    <i class="fas fa-table"></i> Live Presidential Results
  </div>

  <table class="results-table">
    <thead>
      <tr>
        <th>Candidate</th>
        <th>Votes</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>
</div>




<div class="footer">Secure E-Vote System â€¢Designed by : <a href="https://a-finder.vercel.app">McOwino</div>
</div>
<!--
<script>
const API="https://script.google.com/macros/s/AKfycbxnFU1vY12tMMrBmwyKDGr-PsdNQJXnVLyM4sFlapGu3GyC3H3w8K88SgYi8j4f_aAwMA/exec";
const END_TIME=new Date("2025-01-01T23:59:59").getTime();
let locked=false,chart;

/* Countdown */
setInterval(()=>{
  const d=END_TIME-Date.now();
  timer.innerText=d<=0?"Voting Closed":
  `Voting ends in: ${Math.floor(d/36e5)}h ${Math.floor(d%36e5/6e4)}m ${Math.floor(d%6e4/1e3)}s`;
},1000);

/* Vote */
function vote(position,candidate){
  if(locked)return;
  const sid=document.getElementById("sid").value.trim();
  if(!sid)return alert("Enter Student ID");

  locked=true;
  fetch(API,{
    method:"POST",
    body:JSON.stringify({student_id:sid,position,candidate})
  })
  .then(r=>r.json())
  .then(d=>{alert(d.message);locked=false});
}

/* Results + Winner Highlight */
function load(){
  fetch(API).then(r=>r.json()).then(res=>{
    const labels=[],votes=[];
    document.querySelectorAll(".candidate").forEach(c=>c.classList.remove("winner"));

    Object.keys(res).forEach(pos=>{
      const max=Math.max(...res[pos].map(c=>c.votes));
      res[pos].forEach(c=>{
        labels.push(`${c.name} (${pos})`);
        votes.push(c.votes);
        if(c.votes===max && max>0){
          document.querySelectorAll(".candidate").forEach(el=>{
            if(el.innerText.includes(c.name))el.classList.add("winner");
          });
        }
      });
    });

    if(chart)chart.destroy();
    chart=new Chart(chartEl,{type:"bar",data:{labels,datasets:[{data:votes}]},options:{plugins:{legend:{display:false}}}});
  });
}
const chartEl=document.getElementById("chart");
setInterval(load,3000);load();
</script>

-->

<!-- WORKING APPSCRIPT
const OPEN_TIME  = new Date("2025-01-01T00:00:00");
const CLOSE_TIME = new Date("2030-01-01T23:59:59");

function doPost(e){
  const {student_id,position,candidate}=JSON.parse(e.postData.contents||"{}");
  if(!student_id||!position||!candidate)return respond("Invalid request");

  const now=new Date();
  if(now<OPEN_TIME||now>CLOSE_TIME)return respond("Voting is closed");

  const ss=SpreadsheetApp.getActive();
  const students=ss.getSheetByName("Students").getRange("A2:A").getValues().flat();
  if(!students.includes(student_id))return respond("Student ID not registered");

  const candSheet=ss.getSheetByName("Candidates");
  const valid=candSheet.getDataRange().getValues()
    .some(r=>r[0]===candidate&&r[1]===position);
  if(!valid)return respond("Invalid candidate");

  const voteSheet=ss.getSheetByName("Votes");
  const votes=voteSheet.getDataRange().getValues();
  for(let i=1;i<votes.length;i++){
    if(votes[i][1]===student_id&&votes[i][2]===position)
      return respond("You already voted for this position");
  }

  voteSheet.appendRow([new Date(),student_id,position,candidate]);
  return respond("Vote recorded successfully");
}

function doGet(){
  const ss=SpreadsheetApp.getActive();
  const cands=ss.getSheetByName("Candidates").getDataRange().getValues();
  const votes=ss.getSheetByName("Votes").getDataRange().getValues();
  const result={};

  for(let i=1;i<cands.length;i++){
    const [name,pos]=cands[i];
    result[pos]??=[];
    result[pos].push({name,votes:0});
  }

  for(let i=1;i<votes.length;i++){
    const [,,pos,cand]=votes[i];
    const c=result[pos]?.find(x=>x.name===cand);
    if(c)c.votes++;
  }

  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}

function respond(msg){
  return ContentService.createTextOutput(JSON.stringify({message:msg}))
    .setMimeType(ContentService.MimeType.JSON);
}
-->


<!--Start of script for select position to show on frontend-->
<script>
const API="https://script.google.com/macros/s/AKfycbyvUo0mDze9Sczrxf9ja-qP6oZxYPDsJjJ_xRTaBzNu1AaLb-WCptTbjj7l7qrVoJeSNw/exec";
const END_TIME=new Date("2030-01-01T23:59:59").getTime();

let locked=false, chart;
const chartEl=document.getElementById("chart");

/* Countdown */
setInterval(()=>{
  const d=END_TIME-Date.now();
  timer.innerText=d<=0
    ? "Voting Closed"
    : `Voting ends in: ${Math.floor(d/36e5)}h ${Math.floor(d%36e5/6e4)}m ${Math.floor(d%6e4/1e3)}s`;
},1000);

/* Vote */
function vote(position,candidate){
  if(locked) return;
  const sid=document.getElementById("sid").value.trim();
  if(!sid) return alert("Enter Student ID");

  locked=true;
  fetch(API,{
    method:"POST",
    body:JSON.stringify({student_id:sid,position,candidate})
  })
  .then(r=>r.json())
  .then(d=>{
    alert(d.message);
    locked=false;
  });
}

/* PRESIDENT-ONLY RESULTS */
function load(){
  fetch(API)
    .then(r=>r.json())
    .then(res=>{
      if(!res.President) return;

      const labels=[], votes=[];
      document.querySelectorAll(".candidate")
        .forEach(c=>c.classList.remove("winner"));

      const max = Math.max(...res.President.map(c=>c.votes));

      res.President.forEach(c=>{
        labels.push(c.name);
        votes.push(c.votes);

        if(c.votes === max && max > 0){
          document.querySelectorAll(".candidate").forEach(el=>{
            if(el.innerText.includes(c.name))
              el.classList.add("winner");
          });
        }
      });

      if(chart) chart.destroy();
      chart = new Chart(chartEl,{
        type:"bar",
        data:{
          labels,
          datasets:[{ data:votes }]
        },
        options:{
          plugins:{ legend:{ display:false } },
          scales:{ y:{ beginAtZero:true } }
        }
      });
    });
}

setInterval(load,3000);
load();
</script>
<!--End of script for select position to show on frontend-->

<!--Disabled cofirmation modal
<script>
let pendingVote = null;

/* Intercept vote click */
function vote(position, candidate){
  const sid = document.getElementById("sid").value.trim();
  if(!sid) return alert("Enter Student ID");

  pendingVote = { position, candidate };
  showConfirm();
}

/* Confirmation dialog */
function showConfirm(){
  const { position, candidate } = pendingVote;
  const ok = confirm(
    `Please confirm your vote:\n\n` +
    `Position: ${position}\n` +
    `Candidate: ${candidate}\n\n` +
    `This action cannot be undone.`
  );

  if(ok) submitVote();
  else pendingVote = null;
}

/* Actual submission (unchanged backend) */
function submitVote(){
  if(!pendingVote) return;
  if(locked) return;

  locked = true;

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      student_id: document.getElementById("sid").value.trim(),
      position: pendingVote.position,
      candidate: pendingVote.candidate
    })
  })
  .then(r=>r.json())
  .then(d=>{
    alert(d.message);
    pendingVote = null;
    locked = false;
  });
}
</script>
-->

<script>
const RESULTS_API = API; // reuse your API

function loadResultsTable(){
  fetch(RESULTS_API)
    .then(r=>r.json())
    .then(res=>{
      if(!res.President) return;

      const max=Math.max(...res.President.map(c=>c.votes));
      let rows="";

      res.President.forEach(c=>{
        const leader = (c.votes===max && max>0)
          ? "style='color:var(--gold);font-weight:600'"
          : "";
        rows += `<tr ${leader}><td>${c.name}</td><td>${c.votes}</td></tr>`;
      });

      document.getElementById("resultsBody").innerHTML = rows;
    });
}

setInterval(loadResultsTable,3000);
loadResultsTable();
</script>




<script>
let pendingVote = null;

/* Intercept vote */
function vote(position, candidate){
  const sid = document.getElementById("sid").value.trim();
  if(!sid) return alert("Enter Student ID");

  pendingVote = { position, candidate };
  document.getElementById("confirmText").innerHTML =
    `<i class="fas fa-user-tie"></i> ${candidate}<br>
     <small>for ${position}</small>`;

  document.getElementById("confirmOverlay").style.display="flex";
}

/* Cancel */
function cancelVote(){
  pendingVote = null;
  document.getElementById("confirmOverlay").style.display="none";
}

/* Submit */
function submitVote(){
  if(!pendingVote || locked) return;
  locked = true;

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      student_id: document.getElementById("sid").value.trim(),
      position: pendingVote.position,
      candidate: pendingVote.candidate
    })
  })
  .then(r=>r.json())
  .then(d=>{
    alert(d.message);
    cancelVote();
    locked = false;
  });
}
</script>

<script>
/* =================================
   1. Disable Right Click
================================= */
document.addEventListener("contextmenu", e => e.preventDefault());

/* =================================
   2. Disable Copy / Cut / Paste
================================= */
["copy", "cut", "paste", "dragstart"].forEach(evt => {
  document.addEventListener(evt, e => e.preventDefault());
});

/* =================================
   3. Block DevTools Shortcuts
================================= */
document.addEventListener("keydown", function (e) {
  if (
    e.key === "F12" ||
    (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) ||
    (e.ctrlKey && e.key === "U")
  ) {
    e.preventDefault();
    return false;
  }
});

/* =================================
   4. DevTools Size Detection
================================= */
setInterval(() => {
  const widthDiff  = window.outerWidth - window.innerWidth;
  const heightDiff = window.outerHeight - window.innerHeight;

  if (widthDiff > 160 || heightDiff > 160) {
    document.body.innerHTML =
      "<h2 style='color:red;margin-top:20%'>Access Denied</h2>";
  }
}, 1000);

/* =================================
   5. Console Open Detection
================================= */
(function () {
  const element = new Image();
  Object.defineProperty(element, "id", {
    get: function () {
      document.body.innerHTML =
        "<h2 style='color:red;margin-top:20%'>Inspection Blocked</h2>";
    }
  });
  console.log(element);
})();

/* =================================
   6. Anti-Debugger Trap
================================= */
setInterval(function () {
  debugger;
}, 2000);

/* =================================
   7. Hide Source via Visibility Change
================================= */
document.addEventListener("visibilitychange", function () {
  if (document.hidden) {
    document.body.style.display = "none";
  } else {
    document.body.style.display = "block";
  }
});

/* =================================
   8. Disable View Source via Mouse
================================= */
document.onmousedown = function (e) {
  if (e.button === 2) return false;
};
</script>

<!--Tokenize the page on landing page(This Page A)-->
<script>
(async () => {
  const token = new URLSearchParams(window.location.search).get("token");

  if (!token) {
    window.location.replace("frontend.html");
    return;
  }

  const res = await fetch(
    "https://script.google.com/macros/s/AKfycbzG36UvSnkldPrLqPUCsu72XXkou0hd2cDqcBP_2TUF6EiFR18YODAA97ber48gdTDB/exec?action=verify&token=" + token
  );

  const result = await res.text();

  if (result === "OK") {
    document.getElementById("content").style.display = "block";
  } else {
    window.location.replace("frontend.html");
  }
})();
</script>

</body>
</html>
